<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Meritocracia Calendar (CSV)</title>
<style>
  :root { --bg:#0b0b10; --card:#131622; --text:#e6e8ef; --muted:#99a0b3; --grid:#22263a; --accent:#6ea8fe; }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",Arial}
  .wrap{max-width:960px;margin:32px auto;padding:0 16px}
  .card{background:var(--card);border:1px solid var(--grid);border-radius:14px;padding:16px}
  h1{margin:0 0 12px 0;font-size:20px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{border-bottom:1px solid var(--grid);padding:8px;text-align:left;font-size:14px}
  th{color:var(--muted)}
  .status{color:var(--muted);font-size:13px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Meritocracia Calendar（CSV連携テスト）</h1>
      <div class="status" id="status">読み込み中…</div>
      <table id="eventsTable" style="display:none">
        <thead><tr><th>Date</th><th>Title</th><th>Location</th><th>Notes</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="status">CSV: <a id="csvLink" href="#" target="_blank" rel="noopener">open raw</a></div>
    </div>
  </div>

  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const CSV_URL = "https://raw.githubusercontent.com/LANCER1254/calendar-dataset/main/calendar_events.csv";
    document.getElementById('csvLink').href = CSV_URL;

    const statusEl = document.getElementById('status');
    const tbl = document.getElementById('eventsTable');
    const tbody = tbl.querySelector('tbody');

    fetch(CSV_URL + '?t=' + Date.now())
      .then(r => { if(!r.ok) throw new Error('HTTP '+r.status); return r.text(); })
      .then(text => {
        const parsed = Papa.parse(text, { header:true, skipEmptyLines:true });
        const rows = parsed.data
          .map(r => ({ date: r.date?.trim()||"", title: r.title?.trim()||"", location: r.location?.trim()||"", notes: r.notes?.trim()||"" }))
          .sort((a,b) => (a.date||"").localeCompare(b.date||""));
        tbody.innerHTML = rows.map(r => `
          <tr>
            <td>${r.date}</td>
            <td>${r.title}</td>
            <td>${r.location}</td>
            <td>${r.notes}</td>
          </tr>
        `).join('');
        statusEl.textContent = rows.length ? `読み込み成功：${rows.length}件` : 'イベントなし';
        tbl.style.display = rows.length ? '' : 'none';
      })
      .catch(err => {
        console.error(err);
        statusEl.textContent = '読み込み失敗：' + err.message + '（CSV URLや公開設定を確認）';
      });
  </script>
</body>
</html>
